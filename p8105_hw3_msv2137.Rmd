---
title: "HW 3"
author: "Malvika Venkataraman"
date: "10/17/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
```

# Problem 1

```{r}
#load data
library(p8105.datasets)
data("instacart")

#View(instacart)
```

## Description of Data

```{r}
#understanding the dataset
str(instacart)
nrow(instacart)
ncol(instacart)
length(unique(instacart$user_id))

order_1 <- instacart[1,]

order_1$order_id
order_1$product_id
order_1$add_to_cart_order
order_1$product_name
```

The dataset `instacart` records online grocery orders from Instacart users.  It contains `r nrow(instacart)` observations from `r length(unique(instacart$user_id))` unique users. The dataset has `r nrow(instacart)` rows and `r ncol(instacart)` columns. Some key variables are as follows:

* order_id: order identifier
* product_id: product identifier
* reordered: coded as 1 if this product has been ordered by the user in the past, 0 if otherwise
* product_name: name of the product
* order_number: the order sequence number for a user (1 = first, n = nth)
* days_since_prior_order: days since the last order, but capped at 30 days (NA of order_number = 1)

Let's take a look at a single row of data. In order `r order_1$order_id`, user `r order_1$user_id` ordered `r order_1$product_name` (product id = `r order_1$product_id`). The product is from the `r order_1$department` department, and was in the `r order_1$aisle` aisle. It was the `r order_1$add_to_cart_order`st product they added to their cart. This user has placed an order `r order_1$order_number` times before, and this product has been previously ordered by them (reordered = `r order_1$reordered`). The order was placed on a Thursday (order_dow = `r order_1$order_dow`), in the `r order_1$order_hour_of_day`th hour of the day (10am), and `r order_1$days_since_prior_order` days since the user last placed an Instacart order.  

### Aisles

```{r}
aisle_number = instacart %>% 
  distinct(aisle) %>% 
  nrow()
```
There are `r aisle_number` aisles.

```{r}
most_items_aisle = instacart %>% 
  count(aisle) %>% 
  arrange(desc(n)) %>%
  top_n(3)

```

The `r most_items_aisle$aisle[1]` aisle, is where the most items have been ordered from. The `r most_items_aisle$aisle[2]` aisle, is where the second most items have been ordered from. The `r most_items_aisle$aisle[3]` aisle, is where the third most items have been ordered from. 

### Aisles Plot

```{r}
aisle_plot = instacart %>%
  count(aisle) %>%
  mutate(aisle = fct_reorder(aisle, desc(n))) %>%
  filter(n > 10000) %>%
  ggplot(aes(x = aisle, y = n)) + geom_point() + labs(title = "Number of Items Ordered in Each Aisle", x = "Aisle", y = "Number of Items") + theme(axis.text.x = element_text(angle = 90, size = rel(1), hjust = 1))

aisle_plot
```
Add in explanation

### Aisles Table

```{r}
three_most_popular = instacart %>%
  filter(aisle == 'baking ingredients' | aisle == 'dog food care' | aisle == 'packaged vegetables fruits') %>%
  group_by(aisle, product_name) %>%
  summarize(
    count = n()) %>%
  top_n(3, count) %>%
  arrange(aisle, desc(count), product_name)
knitr::kable(three_most_popular)
```

### Pink Lady Apples and Coffee Ice Cream Table

```{r}
days_of_week = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")

mean_hour_order = instacart %>%
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") %>%
  select(product_name, order_dow, order_hour_of_day) %>%
  group_by(product_name, order_dow) %>%
  summarize(
    mean_hour = mean(order_hour_of_day)
  ) %>%
  mutate(order_dow = days_of_week[order_dow + 1]) %>%
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  )
knitr::kable(mean_hour_order, 
             digit = 2, 
             col.names = c("Product Name", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
```

# Problem 2

## Load Data
```{r}
data("brfss_smart2010")

#View(brfss_smart2010)
```

## Data Cleaning
```{r}
brfss_data = brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  mutate(response = factor(response, 
                           levels = c("Poor", "Fair", "Good", "Very Good", "Excellent")))

#View(brfss_data)
```

In 2002, which states were observed at 7 or more locations? What about in 2010?

## 7 or more loactions
```{r}
states_2002 = brfss_data %>%
  filter(year == 2002) %>%
  group_by(locationabbr) %>%
  distinct(locationdesc) %>%
  summarize(num_loc = n()) %>%
  filter(num_loc > 6) %>%
  pull(locationabbr)

states_2010 = brfss_data %>%
  filter(year == 2010) %>%
  group_by(locationabbr) %>%
  distinct(locationdesc) %>%
  summarize(num_loc = n()) %>%
  filter(num_loc > 6) %>%
  pull(locationabbr)

```

The states: `r states_2002` were observed at 7 or more locations in 2002. The states: `r states_2010` were observed at 7 or more locations in 2010.

Construct a dataset that is limited to Excellent responses, and contains, year, state, and a variable that averages the data_value across locations within a state. Make a “spaghetti” plot of this average value over time within a state (that is, make a plot showing a line for each state across years – the geom_line geometry and group aesthetic will help).
Make a two-panel plot showing, for the years 2006, and 2010, distribution of data_value for responses (“Poor” to “Excellent”) among locations in NY State